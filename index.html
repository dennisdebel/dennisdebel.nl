<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<title>dennisdebel</title>
<script src="./jquery.min.js"></script>

<script>
$(function(){
  let manifest = null;

  // ---------- Helpers: sort + pretty labels ----------
  function extractYear(name){
    const m = String(name).match(/^(\d{4})[-_ ]/);
    return m ? parseInt(m[1], 10) : null;
  }

  function prettyName(name){
    return String(name)
      .replace(/[-_]+/g, " ")   // dashes/underscores -> spaces
      .replace(/\s+/g, " ")    // collapse whitespace
      .trim();
  }

  function sortedFolderKeys(section){
    const folders = manifest?.[section] || {};
    const keys = Object.keys(folders);

    return keys.sort((a, b) => {
      const ya = extractYear(a);
      const yb = extractYear(b);

      // If both have years: newest first
      if (ya !== null && yb !== null) {
        if (ya !== yb) return yb - ya;
        return a.localeCompare(b);
      }

      // If only one has a year: year-folders first
      if (ya !== null && yb === null) return -1;
      if (ya === null && yb !== null) return 1;

      // No years: alphabetical
      return a.localeCompare(b);
    });
  }

  // ---------- Boot ----------
  createHeader();

  // Load manifest and initialize routing
  $.getJSON("manifest.json")
    .done(data => {
      manifest = data;
      routeFromURL();
      window.addEventListener("popstate", routeFromURL);
    })
    .fail(() => {
      $("#site-wrapper").html("<p style='color:red'>manifest.json not found</p>");
    });

  // ---------- Router ----------
  function routeFromURL() {
    const params = new URLSearchParams(location.search);
    const section = params.get("section");
    const project = params.get("project");

    // Always clear transient UI
    $(".project-back").remove();
    $("#site-wrapper").empty();

    if (section && project && manifest?.[section]?.[project]) {
      renderProject(section, project);
    } else {
      // Default landing page = featured-only home
      renderHomeFeatured();
    }
  }

  function navigateTo(section, project) {
    const qs = (section && project)
      ? `?section=${encodeURIComponent(section)}&project=${encodeURIComponent(project)}`
      : `./`;
    history.pushState({ section, project }, "", qs);
    routeFromURL();
  }

  // ---------- Header ----------
  function createHeader(){
    $("#global-header").html(`
      <span id='name'><a href='#' id='show-all'>dennis de bel</a></span>
      <span id='menu'>
        <a href='#' id='show-projects'>projects</a> 
        <a href='#' id='show-publications'>publications</a> 
        <a href='#' id='show-activities'>activities</a> 
        <a href='#' id='show-about'>about</a>
      </span>
    `);

    $(document)
      .off("click.nav")
      .on("click.nav", "#show-all", function(e){
        e.preventDefault();
        history.pushState({}, "", "./");
        $(".project-back").remove();
        renderHomeFeatured();
        setActive("all");
      })
      .on("click.nav", "#show-projects", function(e){
        e.preventDefault();
        history.pushState({}, "", "./");
        $(".project-back").remove();
        renderSectionGrid("projects");
        setActive("projects");
      })
      .on("click.nav", "#show-publications", function(e){
        e.preventDefault();
        history.pushState({}, "", "./");
        $(".project-back").remove();
        renderSectionGrid("publications");
        setActive("publications");
      })
      .on("click.nav", "#show-activities", function(e){
        e.preventDefault();
        history.pushState({}, "", "./");
        $(".project-back").remove();
        renderSectionGrid("activities");
        setActive("activities");
      })
      .on("click.nav", "#show-about", function(e){
        e.preventDefault();
        history.pushState({}, "", "./");
        $(".project-back").remove();
        renderAbout();
        setActive("about");
      });
  }

  function setActive(which){
    $("#menu a").removeClass("active");
    if(which === "projects") $("#show-projects").addClass("active");
    else if(which === "publications") $("#show-publications").addClass("active");
    else if(which === "activities") $("#show-activities").addClass("active");
    else if(which === "about") $("#show-about").addClass("active");
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  // ---------- Landing: Featured-only Home ----------
  function renderHomeFeatured(){
    $("#site-wrapper").html("<div class='content grid' style='display:none'></div>");
    const $grid = $("#site-wrapper .grid");

    // If you want a consistent order of sections on the homepage, set it here:
    const sectionOrder = ["projects", "publications", "activities"];
    const sections = sectionOrder.filter(s => manifest?.[s]).concat(
      Object.keys(manifest || {}).filter(s => !sectionOrder.includes(s))
    );

    for (const section of sections){
      if (section === "about") continue;
      const folders = manifest[section];

      for (const folder of sortedFolderKeys(section)){
        const files = folders[folder];

        // Only show featured on home
        const featured = files.find(f => /featured\.(jpe?g)$/i.test(f));
        if (!featured) continue;

        $grid.append(`
          <div class='grid-item ${section}-item' data-section='${section}' data-folder='${folder}'>
            <a href='?section=${encodeURIComponent(section)}&project=${encodeURIComponent(folder)}' class='open-project'>
              <img src='${section}/${featured}' alt='${folder}'/>
            </a>
            <p class='desc'>${prettyName(folder)}</p>
          </div>
        `);
      }
    }

    // Delegate click -> open project
    $grid.off("click.open").on("click.open", ".open-project", function(e){
      e.preventDefault();
      const parent = $(this).closest(".grid-item");
      navigateTo(parent.data("section"), parent.data("folder"));
    });

    $grid.fadeIn(250);
  }

  // ---------- Section Grid: show ALL items ----------
  function renderSectionGrid(section){
    $("#site-wrapper").html("<div class='content grid' style='display:none'></div>");
    const $grid = $("#site-wrapper .grid");

    const folders = manifest?.[section];
    if (!folders) {
      $grid.html(`<p style="padding:2rem">No "${section}" section found in manifest.</p>`);
      $grid.fadeIn(150);
      return;
    }

    for (const folder of sortedFolderKeys(section)){
      const files = folders[folder];

      // For section pages, pick first image (not featured-only)
      const img = files.find(f => /\.(png|jpe?g|gif)$/i.test(f));
      if(!img) continue;

      $grid.append(`
        <div class='grid-item ${section}-item' data-section='${section}' data-folder='${folder}'>
          <a href='?section=${encodeURIComponent(section)}&project=${encodeURIComponent(folder)}' class='open-project'>
            <img src='${section}/${img}' alt='${folder}'/>
          </a>
          <p class='desc'>${prettyName(folder)}</p>
        </div>
      `);
    }

    $grid.off("click.open").on("click.open", ".open-project", function(e){
      e.preventDefault();
      const parent = $(this).closest(".grid-item");
      navigateTo(parent.data("section"), parent.data("folder"));
    });

    $grid.fadeIn(250);
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  // ---------- About View ----------
  function renderAbout(){
    $("#site-wrapper").html("<div class='content about-view' style='display:none'></div>");
    const $view = $("#site-wrapper .about-view");

    const aboutFiles = (manifest?.about?.["."]) || [];
    const txt = aboutFiles.find(f => /\.txt$/i.test(f));
    const img = aboutFiles.find(f => /\.(png|jpe?g|gif)$/i.test(f));

    if (img) {
      $view.append(`<div class='about-image'><img src='about/${img}' alt='about image'/></div>`);
    }
    if (txt) {
      $view.append(`<div class='about-text' data-file='about/${txt}'>Loading…</div>`);
      $.get(`about/${txt}`, t => {
        const $el = $view.find(".about-text");
        if (/\<[^>]+\>/.test(t)) $el.html(t);
        else $el.text(t);
      });
    } else {
      $view.append(`<div class='about-text'>No about.txt found.</div>`);
    }

    $view.fadeIn(250);
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  // ---------- Project View ----------
  function renderProject(section, folder){
    const files = manifest?.[section]?.[folder];
    if(!files){
      renderHomeFeatured();
      return;
    }

    $("#site-wrapper").html("<div class='content project-view' style='display:none'></div>");
    const $view = $("#site-wrapper .project-view");

    // Back button (always present in project view)
    $("#global-header").after(`<div class='project-back'><a href='#' id='back-home'>← back</a></div>`);
    $("#back-home").off("click").on("click", function(e){
      e.preventDefault();
      history.pushState({}, "", "./");
      $(".project-back").remove();
      renderHomeFeatured();
      setActive("all");
    });

    // Images
    for(const f of files){
      if(/\.(png|jpe?g|gif)$/i.test(f)){
        $view.append(`<div class='project-image'><img src='${section}/${f}' alt='${folder}' /></div>`);
      }
    }

    // Text (render HTML if it contains tags)
    for(const f of files){
      if(/\.txt$/i.test(f)){
        $view.append(`<div class='project-text' data-file='${section}/${f}'>Loading…</div>`);
      }
    }

    $view.find(".project-text").each(function(){
      const el = $(this);
      const file = el.data("file");
      $.get(file, t => {
        if (/\<[^>]+\>/.test(t)) el.html(t);
        else el.text(t);
      });
    });

    $view.fadeIn(250);
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

});
</script>

<style>
@font-face {
  font-family:'yolo';
  src:url('./NimbusSanL-Reg.woff2') format('woff2'),
      url('./NimbusSanL-Reg.ttf') format('truetype');
}

body{font-family:"yolo";margin:0;padding:0;background:#fff;}
a{color:black;text-decoration:none}
pre,address{display:none}

/* ---------- Header ---------- */
#global-header{
  position:sticky;
  top:0;
  background:white;
  z-index:999;
  padding:1rem 2rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#menu a{cursor:pointer}
#menu a:hover{text-decoration:underline}
#menu a.active{text-decoration:underline;font-weight:bold}
span#name{font-size:1.3rem}
span#menu{font-size:1.3rem; text-align: right;}

/* ---------- Layout ---------- */
#site-wrapper{
  display:flex;
  justify-content:center;
  width:100%;
  min-height:80vh;
  box-sizing:border-box;
}

/* Centered grid */
.content.grid{
  max-width:1200px;
  width:100%;
  margin:0 auto;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  align-content:flex-start;
  gap:1.25rem;
  padding:2rem 1rem;
  box-sizing:border-box;
}

/* Grid items */
.grid-item{
  display:flex;
  flex-direction:column;
  align-items:center;
  flex:0 1 clamp(260px, 40vw, 520px);
  box-sizing:border-box;
}
.grid-item .desc{
  margin-top:0.5rem;
  text-align:center;
  font-size:0.9rem;
  line-height:1.2;
}
.grid-item img{
  width:100%;
  object-fit:cover;
  border-radius:4px;
  transition:transform .3s ease;
}
.grid-item img:hover{transform:scale(1.02)}

/* Project view */
.project-view img{
  width:100%;
  max-width:800px;
  margin:auto;
  display:block;
  padding-bottom:1rem;
  opacity:0;
  animation:fadeIn .5s forwards;
}
@keyframes fadeIn{to{opacity:1;}}

.project-text,.about-text{
  max-width:600px;
  line-height:1.5em;
  font-size:14px;
  padding:1em;
  margin:auto;
  opacity:0;
  animation:fadeIn .8s forwards;
}

/* About view */
.about-image img{
  max-width: 400px;
  width:100%;
}

/* Back button */
.project-back{
  padding:0.5em 2rem;
  font-size:1rem;
}

/* Footer */
#global-footer{
  width:100%;
  padding:2rem;
  background:white;
  box-sizing:border-box;
}

/* Mobile */
@media (max-width:800px){
  .content.grid{
    padding:1rem;
    gap:0.75rem;
  }
  .grid-item{
    flex:0 1 100%;
    max-width:36rem;
  }
  #global-header{padding:1rem}
}
</style>
</head>

<body>
  <div id="global-header"></div>
  <main id="site-wrapper"></main>
  <footer id="global-footer"></footer>
</body>
</html>
